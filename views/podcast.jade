extends layout

block content
    .container
        #safetitle #{id + '/' + safetitle}
        .col-md-7(id="left-col")
            img.podcast-poster(src="#{feed.imgs.i600}")
            h3 #{feed.title}
            if feed['itunes:summary']
                p #{feed['itunes:summary']}
            table#feedinfo-table(class="table table-bordered")
                tbody
                    tr
                        th Author
                        td #{feed['itunes:author']}
                    tr
                        th Genre
                        td #{feed.genre}
        .col-md-7(id="right-col")
            h3 Episodes
            table#episode-table(class="table table-bordered")
                thead
                    tr
                        th Title
                        th Description
                        th Released
                        th 
                tbody
                    each ep in feed.item
                        tr
                            td(title="#{ep.title}") 
                                if ep.title.length >= 30
                                    span #{ep.title.substr(0,26) + '...'}
                                else
                                    span #{ep.title}
                            if ep.description
                                - var match, front = ep.description.match(/^\<([^\>]+)\>/)
                                - console.log('front: ' + JSON.stringify(front))
                                - if (front) match = ep.description.match('^\<' + front[1] + '\>(.+)\<\/' + front[1] + '\>')
                                - console.log('match: ' + JSON.stringify(match))
                                - if (match) ep.description = match[1]
                                - console.log('d1: ' + ep.description)
                                - ep.description = ep.description.replace(/\<.+\>/g, '')
                                - console.log('d2: ' + ep.description)
                                td(title="#{ep.description}")
                                        
                                    if ep.description.length >= 30
                                        span #{ep.description.substr(0,26) + '...'}
                                    else
                                        span #{ep.description}
                            else
                                td N/A
                            td
                                span #{ep.pubDate}
                            td
                                a.listenlink(href="javascript:void(0)" data-audio="#{ep.enclosure.$.url}" data-title="#{ep.title}" data-poster="#{feed.imgs.i100}") Listen